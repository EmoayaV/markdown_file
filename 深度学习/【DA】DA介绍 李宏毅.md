# 域自适应(Domain Adaptation)

## 1. 各种DA的简介

![image-20220831112553449](D:\markdown file\截图\image-20220831112553449.png)

训练样本和测试样本有差异，训练效果下降，所以要DA技术。DA算是迁移学习(Transfer Learning)的一种。

![image-20220831112754375](D:\markdown file\截图\image-20220831112754375.png)

![image-20220831113150480](D:\markdown file\截图\image-20220831113150480.png)

![image-20220831133540148](D:\markdown file\截图\image-20220831133540148.png)

如果目标域是少量有标签的与源域分布不同的样本，那可以不用DA，直接用把样本放进模型做微调即可。DA真正解决的问题是目标域有大量无标签的与源域分布不同的样本这种情况。

如果目标域样本少还没标签怎么办？

用TTT

![image-20220831133647340](D:\markdown file\截图\image-20220831133647340.png)

![image-20220831133938063](D:\markdown file\截图\image-20220831133938063.png)

如果对目标域什么都不知道怎么办？

这是就不叫DA，叫DG (Domain Generalization)

DG分为两种情况，第一种情况是源域非常丰富有多个domain，目标域只有少数的domain，这种情况好处理，具体看图片里的论文，第二种情况是源域不丰富，只有一个domain，目标域有多个domain，怎么办呢，就用数据增广去扩充源域的domain，转换为第一种情况。



## 2. DA的基本思想

![image-20220831113745068](D:\markdown file\截图\image-20220831113745068.png)

DA基本思想，如果用特征提取器分别对源域和目标域做特征提取，那么就能提取出源域和目标域的相同特征，如果直接用这些特征去在源域训练，那就可以在目标域预测。

![image-20220831115922437](D:\markdown file\截图\image-20220831115922437.png)

假如说一个网络有10层，那么可以把前5层当作一个特征提取器，后5层当作标签预测器，注意这里的层数是一个超参数，自己根据经验定。

![image-20220831115810799](D:\markdown file\截图\image-20220831115810799.png)

如何去使用目标域的数据呢？

先用源域的数据去训练一个网络，然后把目标域和源域的数据都放进网络，拿出特征提取器的结果，将其分布放入一个散点图上，我们的目标就是将两个分布拉近，就是让红点和蓝点分不出差异。

![image-20220831121509458](D:\markdown file\截图\image-20220831121509458.png)

如何拉近源域和目标域经过特征提取器后的特征分布呢？

先把特征提取器提取出的特征作为样本送入一个域二分类器，他的目的是区分这个特征是来自源域还是目标域。特征提取器的目标是尽可能让域二分类器分不出特征是来自源域还是目标域。

如果特征提取器直接摆烂将全部样本的特征都抽取为0怎么办？

不会出现这种问题，因为整个网络是一起训练的，包括特征提取器，标签预测器，域二分类器，如果特征提取器把全部特征都看为0，那么标签预测器的输出的正确率一定会下降，要想让正确率上升就不会把数据看为0。

![image-20220831123100392](D:\markdown file\截图\image-20220831123100392.png)

特征提取器、标签预测器和域二分类器的具体任务是什么？

标签预测器**只对源域有标签的样本**进行预测，他的目的是让源域的分类结果越准确越好，就是一个简单的分类器任务。

域二分类器对源域还是目标域进行分类，他的目的是尽量区分特征是来自源域和目标域。

特征提取器的损失函数是标签预测器的损失 + 负的域二分类器的损失，意思就是在对源域进行正确分类的情况下，域二分类器的效果越差越好，这样就可以拉近源域和目标域的特征分布。

![image-20220831132409147](D:\markdown file\截图\image-20220831132409147.png)

![image-20220831132717450](D:\markdown file\截图\image-20220831132717450.png)

源域和目标域的分布不仅要相同，还要尽量让目标域的样本离源域的分类边界越远越好。如何做呢？

把目标域的样本丢进源域的分类网络里面，如果得到的类别概率越分散，证明目标域样本离分类边界近，如果得到的类别概率越集中，证明目标域样本离分类边界远。还有几种方法在上面图片的下方。

![image-20220831133159016](D:\markdown file\截图\image-20220831133159016.png)

上面讨论的都是源域和目标域类别一一对应的情况，如果源域和目标域的类别不一一对应怎么办呢？

用Universal DA















